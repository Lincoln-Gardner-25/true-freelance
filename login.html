<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="True Freelance - Login to track your freelance projects">
    <title>True Freelance - Login</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700&family=Cormorant+Garamond:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="login-styles.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <!-- Left Floating Images Column -->
    <div class="floating-column floating-column-left">
        <div class="floating-images floating-down">
            <!-- First set -->
            <div class="floating-image">
                <img src="https://images.unsplash.com/photo-1516035069371-29a1b244cc32?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80" alt="Photographer at work">
            </div>
            <div class="floating-image">
                <img src="https://images.unsplash.com/photo-1504307651254-35680f356dfd?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80" alt="Roofer at work">
            </div>
            <div class="floating-image">
                <img src="https://images.unsplash.com/photo-1452860606245-08befc0ff44b?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80" alt="Woodworker making desk">
            </div>
            <div class="floating-image">
                <img src="https://images.unsplash.com/photo-1524178232363-1fb2b075b655?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80" alt="Teacher giving lecture">
            </div>
            <!-- Duplicate set for seamless loop -->
            <div class="floating-image">
                <img src="https://images.unsplash.com/photo-1516035069371-29a1b244cc32?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80" alt="Photographer at work">
            </div>
            <div class="floating-image">
                <img src="https://images.unsplash.com/photo-1504307651254-35680f356dfd?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80" alt="Roofer at work">
            </div>
            <div class="floating-image">
                <img src="https://images.unsplash.com/photo-1452860606245-08befc0ff44b?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80" alt="Woodworker making desk">
            </div>
            <div class="floating-image">
                <img src="https://images.unsplash.com/photo-1524178232363-1fb2b075b655?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80" alt="Teacher giving lecture">
            </div>
        </div>
    </div>

    <!-- Right Floating Images Column -->
    <div class="floating-column floating-column-right">
        <div class="floating-images floating-up">
            <!-- First set -->
            <div class="floating-image">
                <img src="https://images.unsplash.com/photo-1475721027785-f74eccf877e2?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80" alt="Public speaker">
            </div>
            <div class="floating-image">
                <img src="https://images.unsplash.com/photo-1507838153414-b4b713384a76?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80" alt="Musician writing music">
            </div>
            <div class="floating-image">
                <img src="https://images.unsplash.com/photo-1571019614242-c5c5dee9f50b?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80" alt="Fitness coach at gym">
            </div>
            <div class="floating-image">
                <img src="https://images.unsplash.com/photo-1460661419201-fd4cecdf8a8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80" alt="Artist painting">
            </div>
            <!-- Duplicate set for seamless loop -->
            <div class="floating-image">
                <img src="https://images.unsplash.com/photo-1475721027785-f74eccf877e2?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80" alt="Public speaker">
            </div>
            <div class="floating-image">
                <img src="https://images.unsplash.com/photo-1507838153414-b4b713384a76?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80" alt="Musician writing music">
            </div>
            <div class="floating-image">
                <img src="https://images.unsplash.com/photo-1571019614242-c5c5dee9f50b?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80" alt="Fitness coach at gym">
            </div>
            <div class="floating-image">
                <img src="https://images.unsplash.com/photo-1460661419201-fd4cecdf8a8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80" alt="Artist painting">
            </div>
        </div>
    </div>

    <!-- Center Login Content -->
    <main class="login-main">
        <div class="login-container">
            <!-- Logo -->
            <div class="logo-container">
                <h1 class="logo">TR</h1>
                <p class="logo-tagline">True Freelance</p>
            </div>

            <!-- Login Form -->
            <form class="login-form" id="loginForm">
                <div class="form-group">
                    <label for="email" class="form-label">Email</label>
                    <input
                        type="email"
                        id="email"
                        class="form-input"
                        placeholder="Enter your email"
                        required
                    >
                </div>

                <div class="form-group">
                    <label for="password" class="form-label">Password</label>
                    <input
                        type="password"
                        id="password"
                        class="form-input"
                        placeholder="Enter your password"
                        required
                        minlength="6"
                    >
                </div>

                <div id="authError" class="auth-error" style="color: #c0392b; margin-bottom: 1rem; display: none;"></div>

                <button type="submit" class="btn-login" id="submitBtn">Sign In</button>
            </form>

            <div class="auth-toggle" style="text-align: center; margin-top: 1rem;">
                <p id="toggleText" style="color: #666;">Don't have an account? <a href="#" id="toggleLink" style="color: #8b7355;">Sign Up</a></p>
            </div>

            <p class="login-footer">Track your worth. Know your rate.</p>
        </div>
    </main>

    <script src="supabase.js"></script>
    <script>
        let isSignUp = false;
        const form = document.getElementById('loginForm');
        const submitBtn = document.getElementById('submitBtn');
        const toggleLink = document.getElementById('toggleLink');
        const toggleText = document.getElementById('toggleText');
        const authError = document.getElementById('authError');

        // Check if already logged in
        (async function() {
            const { data: { session } } = await window.supabaseClient.auth.getSession();
            if (session) {
                window.location.href = 'door.html';
            }
        })();

        toggleLink.addEventListener('click', function(e) {
            e.preventDefault();
            isSignUp = !isSignUp;
            if (isSignUp) {
                submitBtn.textContent = 'Sign Up';
                toggleText.innerHTML = 'Already have an account? <a href="#" id="toggleLink" style="color: #8b7355;">Sign In</a>';
            } else {
                submitBtn.textContent = 'Sign In';
                toggleText.innerHTML = 'Don\'t have an account? <a href="#" id="toggleLink" style="color: #8b7355;">Sign Up</a>';
            }
            // Re-attach event listener to new link
            document.getElementById('toggleLink').addEventListener('click', arguments.callee.bind(this));
            authError.style.display = 'none';
        });

        form.addEventListener('submit', async function(e) {
            e.preventDefault();
            authError.style.display = 'none';
            submitBtn.disabled = true;
            submitBtn.textContent = isSignUp ? 'Signing up...' : 'Signing in...';

            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            try {
                let result;
                if (isSignUp) {
                    result = await window.supabaseClient.auth.signUp({
                        email: email,
                        password: password
                    });
                } else {
                    result = await window.supabaseClient.auth.signInWithPassword({
                        email: email,
                        password: password
                    });
                }

                if (result.error) {
                    throw result.error;
                }

                if (isSignUp && !result.data.session) {
                    // Email confirmation required
                    authError.style.color = '#27ae60';
                    authError.textContent = 'Check your email to confirm your account!';
                    authError.style.display = 'block';
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'Sign Up';
                } else {
                    // Redirect on successful login
                    window.location.href = 'door.html';
                }
            } catch (error) {
                authError.style.color = '#c0392b';
                authError.textContent = error.message;
                authError.style.display = 'block';
                submitBtn.disabled = false;
                submitBtn.textContent = isSignUp ? 'Sign Up' : 'Sign In';
            }
        });
    </script>
</body>
</html>
